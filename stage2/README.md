# Stage 2: LinkedIn Scraper (Playwright)

This project logs into LinkedIn, visits a list of profile URLs, scrapes data using provided XPaths, and stores results in a Supabase table `lead_details`.

## Features
- Playwright browser automation with human-like timing
- Optional persistent session to avoid frequent logins
- Util function `scrapeProfile(page, url)` returning the specified schema
- Util function `saveLeadToSupabase(lead)` to store into Supabase

## Setup
1. Copy `.env.example` to `.env` and fill variables:
```
cp .env.example .env
```

2. Install dependencies:
```
npm install
```

3. Provide input URLs in `src/urls.sample.json` or pass via CLI.

The script now explicitly loads `.env` from the project root, so you can run it from any working directory (e.g. project root or inside `src/`). If required env vars are missing it will exit with a clear message. Sessions are intentionally NOT persisted; every run starts with a clean browser profile (no cached cookies or local storage) to ensure a fresh login each time.

## Run
-- Default run (reads from `src/urls.sample.json`):
```
npm run scrape
```

-- With custom URLs file:
```
node src/stage2.js src/my-urls.json
```

-- Headed mode for debugging:
```
HEADLESS=false npm run scrape
```

## Required Environment Variables
The following are required and validated on startup:
- LINKEDIN_EMAIL
- LINKEDIN_PASSWORD
- SUPABASE_URL
- SUPABASE_ANON_KEY

Optional (defaults shown if omitted):
- HEADLESS (true)
- SLOW_MO (75)
- OUTPUT_JSON (unset)

## Notes
- Respect LinkedIn's Terms of Service and robots.txt. This code is for educational purposes.
- Scraping LinkedIn may violate their terms; your account may be restricted.

## Supabase Schema
Create the `lead_details` table (JSON for `skills`):
```
create table if not exists public.lead_details (
	id bigint generated by default as identity primary key,
	lead_id text,
	name text,
	title text,
	location text,
	profile_url text,
	bio text,
	skills jsonb default '[]'::jsonb,
	experience text,
	company_name text,
	company_page_url text,
	created_at timestamp with time zone default now()
);
```
